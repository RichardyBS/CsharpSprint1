# ========================================
# COMANDOS AZURE CLI - PROJETO MOTTONOTIFICACAO
# ========================================

# 1. Login no Azure
az login

# 2. Criar Resource Group
az group create --name rg-mottonotificacao --location brazilsouth

# 3. Criar Azure SQL Server
az sql server create \
  --name sqlserver-mottonotificacao \
  --resource-group rg-mottonotificacao \
  --location brazilsouth \
  --admin-user admsql \
  --admin-password "devops@Fiap2tds"

# 4. Criar Database (Free Tier)
az sql db create \
  --resource-group rg-mottonotificacao \
  --server sqlserver-mottonotificacao \
  --name bd-mottonotificacao \
  --service-objective Free

# 5. Configurar Firewall (permitir todos os IPs)
az sql server firewall-rule create \
  --resource-group rg-mottonotificacao \
  --server sqlserver-mottonotificacao \
  --name AllowAllIps \
  --start-ip-address 0.0.0.0 \
  --end-ip-address 255.255.255.255

# 6. Criar VM Ubuntu (Free Tier)
az vm create \
  --resource-group rg-mottonotificacao \
  --name vm-mottonotificacao \
  --image Ubuntu2204 \
  --size Standard_B1s \
  --location brazilsouth \
  --admin-username azureuser \
  --generate-ssh-keys \
  --public-ip-sku Standard

# 7. Abrir portas na VM
az vm open-port --port 80 --resource-group rg-mottonotificacao --name vm-mottonotificacao --priority 1000
az vm open-port --port 5000 --resource-group rg-mottonotificacao --name vm-mottonotificacao --priority 1001
az vm open-port --port 443 --resource-group rg-mottonotificacao --name vm-mottonotificacao --priority 1002

# 8. Obter IP público da VM
az vm show --resource-group rg-mottonotificacao --name vm-mottonotificacao --show-details --query publicIps --output tsv

# ========================================
# INFORMAÇÕES DE CONEXÃO
# ========================================
# SQL Server: sqlserver-mottonotificacao.database.windows.net
# Database: bd-mottonotificacao
# User: admsql
# Password: devops@Fiap2tds
# VM: vm-mottonotificacao
# Resource Group: rg-mottonotificacao